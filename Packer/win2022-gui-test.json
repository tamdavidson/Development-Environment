{
    "variables": {
        "boot_wait": "5s",
        "disk_size": "40960",
        "iso_checksum": "4F1457C4FE14CE48C9B2324924F33CA4F0470475E6DA851B39CCBF98F44E7852",
        "iso_url": "20348.169.210806-2348.fe_release_svc_refresh_SERVER_EVAL_x64FRE_en-us (1).iso",
        "memsize": "2048",
        "numvcpus": "2",
        "vm_name": "Win2022_20324_test",
        "winrm_password" : "packer",
        "winrm_username" : "Administrator", 

        "esxi_host" : "", 
        "esxi_username" : "", 
        "esxi_password" : "",
        "esxi_datastore" : "",
        "esxi_iso_directory": ""
        
    },

    "sensitive-variables": ["esxi_password", "winrm_password"],

    
    
    "builders": [
        {
            "type": "vmware-iso",
            "guest_os_type": "windows2019srv-64",
            
            "remote_type": "esx5",
            "remote_host": "{{user `esxi_host`}}",
            "remote_port": "22",
            "remote_datastore": "{{user `esxi_datastore`}}",
            "remote_cache_directory": "{{user `esxi_iso_directory`}}",
            "remote_username": "{{user `esxi_username`}}",
            "remote_password": "{{user `esxi_password`}}",



            "vnc_disable_password": true, 
            "vnc_over_websocket": true,
            "insecure_connection": true,
            
            "keep_registered": true, 



            "vm_name":"{{user `vm_name`}}",
            "boot_wait": "{{user `boot_wait`}}",
            "disk_size": "{{user `disk_size`}}",
            "headless": false,
            "iso_checksum": "{{user `iso_checksum`}}",
            "iso_url": "{{user `iso_url`}}",
            "communicator":"winrm",
            "winrm_username": "{{user `winrm_username`}}",
            "winrm_password": "{{user `winrm_password`}}",
            "winrm_use_ssl": true,
            "winrm_insecure": true,
            "winrm_timeout": "4h",
            "floppy_files": ["scripts/bios/gui/autounattend.xml"],
            "shutdown_command": "shutdown /s /t 5 /f /d p:4:1 /c \"Packer Shutdown\"",
            "shutdown_timeout": "30m",
            
            "network_adapter_type": "E1000e",
            "network_name": "VM Network",

            "vmx_data": {
                "memsize": "{{user `memsize`}}",
                "numvcpus": "{{user `numvcpus`}}",
                "virtualHW.version": "14",
                "scsi0.virtualDev": "lsisas1068"
            }
        },
        {
            "type": "virtualbox-iso",
            "guest_os_type": "Windows2019_64",
            "vm_name": "{{user `vm_name`}}",
            "iso_url": "{{user `iso_url`}}",
            "iso_checksum": "{{user `iso_checksum`}}",
            "guest_additions_mode": "disable",
            "headless": false,
            "boot_wait": "{{user `boot_wait`}}",
            "disk_size": "{{user `disk_size`}}",
            "communicator":"winrm",
            "winrm_username": "{{user `winrm_username`}}",
            "winrm_password": "{{user `winrm_password`}}",
            "winrm_use_ssl": true,
            "winrm_insecure": true,
            "winrm_timeout": "4h",
            "floppy_files": ["scripts/bios/gui/autounattend.xml"],
            "shutdown_command": "shutdown /s /t 5 /f /d p:4:1 /c \"Packer Shutdown\"",
            "shutdown_timeout": "30m",
            "vboxmanage": [
                ["modifyvm", "{{.Name}}", "--memory", "{{user `memsize`}}"],
                ["modifyvm", "{{.Name}}", "--cpus", "{{user `numvcpus`}}"]
            ]
        }
    ],
    "provisioners": [
        {
            "type": "powershell",
            "only": ["vmware-iso"],
            "scripts": ["scripts/vmware-tools.ps1"],
            "pause_before": "1m"
        },
        {
            "type": "powershell",
            "only": ["virtualbox-iso"],
            "scripts": ["scripts/virtualbox-guest-additions.ps1"],
            "pause_before": "1m"
        },
        {
            "type": "powershell",
            "scripts": ["scripts/setup.ps1"]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "30m"
        },
        {
            "type": "powershell",
            "scripts": ["scripts/win-update.ps1"]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "30m"
        },
        {
            "type": "powershell",
            "scripts": ["scripts/win-update.ps1"]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "30m"
        },
        {
            "type": "powershell",
            "scripts": ["scripts/cleanup.ps1"],
            "pause_before": "1m"
        }
    ]
}
